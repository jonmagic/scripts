#!/usr/bin/env bun
/**
 * archive-meeting: Archive a single meeting into the brain repo.
 *
 * Usage:
 *   archive-meeting --brain-dir DIR --input PATH --meeting-notes-target TARGET \
 *     --executive-summary-prompt-path PATH --detailed-notes-prompt-path PATH \
 *     [--date YYYY-MM-DD] [--dry-run]
 */

import { parseArgs } from "node:util"
import { archiveMeeting } from "../src/archive-meeting.js"

const { values } = parseArgs({
  options: {
    "brain-dir": { type: "string" },
    input: { type: "string" },
    "meeting-notes-target": { type: "string" },
    "executive-summary-prompt-path": { type: "string" },
    "detailed-notes-prompt-path": { type: "string" },
    date: { type: "string" },
    "dry-run": { type: "boolean" },
    help: { type: "boolean", short: "h" },
  },
})

if (values.help) {
  console.log(`
Usage: archive-meeting [options]

Options:
  --brain-dir DIR                      Path to Brain directory (required)
  --input PATH                         Path to input (VTT file or Zoom folder) (optional, fzf if omitted)
  --meeting-notes-target TARGET        Meeting Notes target basename (optional, fzf if omitted)
  --executive-summary-prompt-path PATH Path to prompt file for executive summary (required)
  --detailed-notes-prompt-path PATH    Path to prompt file for detailed notes (required)
  --date YYYY-MM-DD                    Override meeting date (defaults to file mtime)
  --dry-run                            Show what would be done without writing files
  -h, --help                           Show this help message
`)
  process.exit(0)
}

if (
  !values["brain-dir"] ||
  !values["executive-summary-prompt-path"] ||
  !values["detailed-notes-prompt-path"]
) {
  console.error("Missing required arguments. Use --help for usage information.")
  process.exit(1)
}

await archiveMeeting({
  brainDir: values["brain-dir"],
  input: values["input"],
  meetingNotesTarget: values["meeting-notes-target"],
  executiveSummaryPromptPath: values["executive-summary-prompt-path"],
  detailedNotesPromptPath: values["detailed-notes-prompt-path"],
  date: values["date"],
  dryRun: values["dry-run"],
})
